# AI-Trader å†³ç­–é¢‘ç‡ä¸è§¦å‘æœºåˆ¶åˆ†æ

æœ¬æ–‡æ¡£æ·±å…¥åˆ†æAI-Traderçš„å†³ç­–æœºåˆ¶ï¼Œå¯¹æ¯”å†å²å›æµ‹å’Œå®æ—¶æ¨¡æ‹Ÿç›˜çš„ä¸åŒè§¦å‘ç­–ç•¥ã€‚

---

## ğŸ“‹ ç›®å½•

1. [å½“å‰å›æµ‹å†³ç­–æœºåˆ¶](#å½“å‰å›æµ‹å†³ç­–æœºåˆ¶)
2. [å†³ç­–é¢‘ç‡å®è¯åˆ†æ](#å†³ç­–é¢‘ç‡å®è¯åˆ†æ)
3. [å®æ—¶æ¨¡æ‹Ÿç›˜è§¦å‘ç­–ç•¥](#å®æ—¶æ¨¡æ‹Ÿç›˜è§¦å‘ç­–ç•¥)
4. [å®šæ—¶åˆ†æ vs äº‹ä»¶è§¦å‘](#å®šæ—¶åˆ†æ-vs-äº‹ä»¶è§¦å‘)
5. [æ¨èæ–¹æ¡ˆ](#æ¨èæ–¹æ¡ˆ)

---

## ğŸ” å½“å‰å›æµ‹å†³ç­–æœºåˆ¶

### æ ¸å¿ƒé—®é¢˜å›ç­”

**Q: ä¸€å¤©å†³ç­–å‡ æ¬¡ï¼Ÿ**

**A: æ¯å¤©åªè§¦å‘1æ¬¡å†³ç­–ä¼šè¯ï¼Œä½†ä¼šè¯å†…å¯èƒ½äº§ç”Ÿå¤šæ¬¡äº¤æ˜“**

---

### å†³ç­–æµç¨‹è¯¦è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¯ä¸ªäº¤æ˜“æ—¥çš„å®Œæ•´æµç¨‹                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“… æ—¥æœŸ: 2025-10-02 (å•ä¸ªäº¤æ˜“æ—¥)
   â”‚
   v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: å¯åŠ¨å•æ—¥äº¤æ˜“ä¼šè¯ (run_trading_session)               â”‚
â”‚         - æ¯å¤©åªè°ƒç”¨ 1 æ¬¡                                    â”‚
â”‚         - æ—¶é—´ç‚¹ï¼šä»»æ„ï¼ˆæ‰¹é‡å›æµ‹æ¨¡å¼ï¼‰                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: ç”Ÿæˆç³»ç»Ÿæç¤ºè¯                                        â”‚
â”‚         - ä»Šæ—¥æ—¥æœŸ: 2025-10-02                               â”‚
â”‚         - æ˜¨æ—¥æŒä»“: {"CASH": 10000.0, ...}                  â”‚
â”‚         - ä»Šæ—¥ä»·æ ¼: {"AAPL_price": 182.0, ...}              â”‚
â”‚                                                             â”‚
â”‚ Step 3: å‘é€åˆå§‹æŸ¥è¯¢                                         â”‚
â”‚         User: "Please analyze and update today's positions" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Agent å†³ç­–å¾ªç¯ (æœ€å¤š30æ­¥)                            â”‚
â”‚                                                             â”‚
â”‚   Round 1:                                                  â”‚
â”‚   â”œâ”€ Agentæ€è€ƒ: "æˆ‘éœ€è¦åˆ†æå¸‚åœºå¹¶å»ºä»“"                        â”‚
â”‚   â”œâ”€ Toolè°ƒç”¨: get_information("NVDA news")                â”‚
â”‚   â””â”€ Toolç»“æœ: {"results": [...]}                          â”‚
â”‚                                                             â”‚
â”‚   Round 2:                                                  â”‚
â”‚   â”œâ”€ Agentæ€è€ƒ: "NVDAå‰æ™¯å¥½ï¼Œä¹°å…¥10è‚¡"                       â”‚
â”‚   â”œâ”€ Toolè°ƒç”¨: buy("NVDA", 10)           â† äº¤æ˜“1           â”‚
â”‚   â””â”€ Toolç»“æœ: {"NVDA": 10, "CASH": 8580}                  â”‚
â”‚                                                             â”‚
â”‚   Round 3:                                                  â”‚
â”‚   â”œâ”€ Agentæ€è€ƒ: "ç»§ç»­ä¹°å…¥MSFT"                               â”‚
â”‚   â”œâ”€ Toolè°ƒç”¨: buy("MSFT", 3)            â† äº¤æ˜“2           â”‚
â”‚   â””â”€ Toolç»“æœ: {"MSFT": 3, "CASH": 7314}                   â”‚
â”‚                                                             â”‚
â”‚   Round 4:                                                  â”‚
â”‚   â”œâ”€ Agentæ€è€ƒ: "ä¹°å…¥AAPL"                                  â”‚
â”‚   â”œâ”€ Toolè°ƒç”¨: buy("AAPL", 5)            â† äº¤æ˜“3           â”‚
â”‚   â””â”€ Toolç»“æœ: {"AAPL": 5, "CASH": 6404}                   â”‚
â”‚                                                             â”‚
â”‚   ... (ç»§ç»­åˆ°ç¬¬8æ¬¡äº¤æ˜“)                                      â”‚
â”‚                                                             â”‚
â”‚   Round N:                                                  â”‚
â”‚   â”œâ”€ Agentæ€è€ƒ: "æŠ•èµ„ç»„åˆå·²å®Œæˆ"                             â”‚
â”‚   â””â”€ è¾“å‡º: <FINISH_SIGNAL>               â† ä¼šè¯ç»“æŸ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“æœ: 1æ¬¡å†³ç­–ä¼šè¯ = 8æ¬¡äº¤æ˜“è®°å½•
```

---

### å…³é”®ä»£ç ä½ç½®

#### 1. æ—¥æœŸå¾ªç¯ï¼ˆæ¯å¤©è°ƒç”¨1æ¬¡ï¼‰

**æ–‡ä»¶**: `base_agent.py:375-410`

```python
async def run_date_range(self, init_date: str, end_date: str):
    """è¿è¡Œæ‰€æœ‰äº¤æ˜“æ—¥"""
    trading_dates = self.get_trading_dates(init_date, end_date)

    # æ¯ä¸ªæ—¥æœŸè°ƒç”¨ä¸€æ¬¡äº¤æ˜“ä¼šè¯
    for date in trading_dates:  # ["2025-10-01", "2025-10-02", ...]
        print(f"ğŸ”„ Processing Date: {date}")

        # æ¯å¤©åªè°ƒç”¨1æ¬¡
        await self.run_trading_session(date)  â¬…ï¸ æ¯å¤©1æ¬¡
```

#### 2. å•æ—¥äº¤æ˜“ä¼šè¯ï¼ˆå†…éƒ¨å¯å¤šæ¬¡äº¤æ˜“ï¼‰

**æ–‡ä»¶**: `base_agent.py:193-269`

```python
async def run_trading_session(self, today_date: str):
    """è¿è¡Œå•æ—¥äº¤æ˜“ä¼šè¯"""

    # 1. ç”Ÿæˆä»Šæ—¥ç³»ç»Ÿæç¤ºè¯ï¼ˆåªç”Ÿæˆ1æ¬¡ï¼‰
    self.agent = create_agent(
        system_prompt=get_agent_system_prompt(today_date, self.signature)
    )

    # 2. å‘é€åˆå§‹æŸ¥è¯¢ï¼ˆåªå‘é€1æ¬¡ï¼‰
    user_query = [{
        "role": "user",
        "content": f"Please analyze and update today's ({today_date}) positions."
    }]

    # 3. Agentå†³ç­–å¾ªç¯ï¼ˆå¯èƒ½å¤šæ¬¡äº¤æ˜“ï¼‰
    current_step = 0
    while current_step < self.max_steps:  # æœ€å¤š30æ­¥
        current_step += 1

        # Agentè°ƒç”¨å·¥å…·
        response = await self._ainvoke_with_retry(message)

        # æ£€æŸ¥æ˜¯å¦å®Œæˆ
        if STOP_SIGNAL in agent_response:
            break  # ç»“æŸä¼šè¯

        # æå–å·¥å…·ç»“æœï¼Œç»§ç»­ä¸‹ä¸€è½®
        tool_response = extract_tool_messages(response)
        message.extend([
            {"role": "assistant", "content": agent_response},
            {"role": "user", "content": f'Tool results: {tool_response}'}
        ])
```

#### 3. äº¤æ˜“æ‰§è¡Œï¼ˆæ¯æ¬¡buy/sellè°ƒç”¨ï¼‰

**æ–‡ä»¶**: `agent_tools/tool_trade.py:15-103`

```python
@mcp.tool()
def buy(symbol: str, amount: int):
    """ä¹°å…¥è‚¡ç¥¨"""
    # æ¯æ¬¡buy()è°ƒç”¨éƒ½å†™å…¥ä¸€æ¡è®°å½•
    with open(position_file_path, "a") as f:
        f.write(json.dumps({
            "date": today_date,
            "id": current_action_id + 1,
            "this_action": {"action": "buy", "symbol": symbol, "amount": amount},
            "positions": new_position
        }) + "\n")  # â¬…ï¸ æ¯æ¬¡äº¤æ˜“è®°å½•1è¡Œ
```

---

## ğŸ“Š å†³ç­–é¢‘ç‡å®è¯åˆ†æ

### çœŸå®æ•°æ®ç»Ÿè®¡

ä» `claude-3.7-sonnet` æ¨¡å‹çš„å®é™…è¿è¡Œæ•°æ®ï¼š

```bash
# æ•°æ®æ¥æº: data/agent_data/claude-3.7-sonnet/position/position.jsonl

2025-10-01: 1 æ¬¡äº¤æ˜“  (åˆå§‹å»ºä»“)
2025-10-02: 8 æ¬¡äº¤æ˜“  (åˆ†æ‰¹ä¹°å…¥å¤šåªè‚¡ç¥¨)
2025-10-03: 3 æ¬¡äº¤æ˜“  (è°ƒæ•´ä»“ä½)
2025-10-06: 3 æ¬¡äº¤æ˜“  (å‘¨æœ«åé‡æ–°å»ºä»“)
2025-10-07: 1 æ¬¡äº¤æ˜“  (å°å¹…è°ƒæ•´)
2025-10-08: 4 æ¬¡äº¤æ˜“  (ä¸­ç­‰è°ƒæ•´)
...
```

### 2025-10-02 çš„8æ¬¡äº¤æ˜“è¯¦æƒ…

```
10:00 AM (è™šæ‹Ÿæ—¶é—´) - å¯åŠ¨ä¼šè¯
  â””â”€ User: "Please analyze and update today's positions"

Step 1-2: ä¿¡æ¯æ”¶é›†
  â””â”€ get_information("NVDA news")
  â””â”€ get_information("market trends")

Step 3: äº¤æ˜“1 - buy("NVDA", 10)
  â””â”€ æŒä»“: {"NVDA": 10, "CASH": 8580}

Step 4: äº¤æ˜“2 - buy("MSFT", 3)
  â””â”€ æŒä»“: {"NVDA": 10, "MSFT": 3, "CASH": 7314}

Step 5: äº¤æ˜“3 - buy("AAPL", 5)
  â””â”€ æŒä»“: {"NVDA": 10, "MSFT": 3, "AAPL": 5, "CASH": 6404}

Step 6: äº¤æ˜“4 - buy("PLTR", 5)
Step 7: äº¤æ˜“5 - buy("ASML", 1)
Step 8: äº¤æ˜“6 - buy("AMD", 5)
Step 9: äº¤æ˜“7 - buy("META", 1)
Step 10: äº¤æ˜“8 - buy("AVGO", 4)

Step 11: Agentè¾“å‡º <FINISH_SIGNAL>
  â””â”€ ä¼šè¯ç»“æŸ

æ€»è€—æ—¶: çº¦2-3åˆ†é’Ÿ (å–å†³äºAPIå»¶è¿Ÿå’ŒAgentæ€è€ƒ)
```

---

### å†³ç­–æœºåˆ¶æ€»ç»“

| ç»´åº¦ | å½“å‰å›æµ‹æ¨¡å¼ |
|------|------------|
| **ä¼šè¯è§¦å‘é¢‘ç‡** | æ¯å¤©1æ¬¡ |
| **è§¦å‘æ—¶é—´ç‚¹** | æ‰¹é‡å¤„ç†æ—¶æŒ‰é¡ºåºï¼ˆæ— å®é™…æ—¶é—´æ¦‚å¿µï¼‰ |
| **å•æ¬¡ä¼šè¯å†…äº¤æ˜“æ¬¡æ•°** | ä¸é™åˆ¶ï¼ˆç”±Agentå†³å®šï¼Œé€šå¸¸1-8æ¬¡ï¼‰ |
| **æœ€å¤§å†³ç­–æ­¥æ•°** | 30æ­¥ï¼ˆmax_stepsé…ç½®ï¼‰ |
| **ä¼šè¯æŒç»­æ—¶é—´** | 2-5åˆ†é’Ÿï¼ˆå–å†³äºAgentæ€è€ƒå’ŒAPIè°ƒç”¨ï¼‰ |
| **äº¤æ˜“ä»·æ ¼** | ç»Ÿä¸€ä½¿ç”¨å½“å¤©å¼€ç›˜ä»· |
| **æ˜¯å¦è·¨æ—¶æ®µ** | å¦ï¼Œå•æ¬¡ä¼šè¯å†…å®Œæˆæ‰€æœ‰å†³ç­– |

---

## ğŸš€ å®æ—¶æ¨¡æ‹Ÿç›˜è§¦å‘ç­–ç•¥

### ç­–ç•¥å¯¹æ¯”

å®æ—¶æ¨¡æ‹Ÿç›˜æœ‰ä¸¤ç§æ ¸å¿ƒç­–ç•¥ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç­–ç•¥A: å®šæ—¶åˆ†æï¼ˆTime-Based Triggerï¼‰                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹: å›ºå®šæ—¶é—´ç‚¹æ‰§è¡Œï¼Œç±»ä¼¼å½“å‰å›æµ‹æ¨¡å¼

â° 09:30 - å¸‚åœºå¼€ç›˜
   â””â”€ è§¦å‘å™¨: æ— åŠ¨ä½œï¼ˆç­‰å¾…å¼€ç›˜ç¨³å®šï¼‰

â° 10:00 - æ—©ç›˜åˆ†ææ—¶æ®µ
   â””â”€ è§¦å‘å™¨: è¿è¡Œ1æ¬¡å®Œæ•´å†³ç­–ä¼šè¯
   â””â”€ Agentè·å–æœ€æ–°ä»·æ ¼ â†’ åˆ†æ â†’ äº¤æ˜“
   â””â”€ ä¼šè¯ç»“æŸåç­‰å¾…ä¸‹ä¸€ä¸ªæ—¶é—´ç‚¹

â° 14:00 - åˆç›˜åˆ†ææ—¶æ®µï¼ˆå¯é€‰ï¼‰
   â””â”€ è§¦å‘å™¨: è¿è¡Œ1æ¬¡å®Œæ•´å†³ç­–ä¼šè¯

â° 15:45 - å°¾ç›˜åˆ†ææ—¶æ®µï¼ˆå¯é€‰ï¼‰
   â””â”€ è§¦å‘å™¨: è¿è¡Œ1æ¬¡å®Œæ•´å†³ç­–ä¼šè¯

â° 16:00 - å¸‚åœºæ”¶ç›˜
   â””â”€ è§¦å‘å™¨: æ— åŠ¨ä½œï¼ˆç­‰å¾…æ˜å¤©ï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç­–ç•¥B: äº‹ä»¶è§¦å‘ï¼ˆEvent-Based Triggerï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹: åŸºäºå¸‚åœºäº‹ä»¶å®æ—¶å“åº”

ğŸ“Š äº‹ä»¶1: æŒä»“è‚¡ç¥¨æ¶¨è·Œå¹… > 5%
   â””â”€ è§¦å‘å™¨: ç«‹å³è¿è¡Œå†³ç­–ä¼šè¯
   â””â”€ ç¤ºä¾‹: NVDAæ¶¨äº†8% â†’ è§¦å‘æ­¢ç›ˆåˆ†æ

ğŸ“° äº‹ä»¶2: é‡å¤§æ–°é—»å‘å¸ƒ
   â””â”€ è§¦å‘å™¨: ç«‹å³è¿è¡Œå†³ç­–ä¼šè¯
   â””â”€ ç¤ºä¾‹: Appleå‘å¸ƒè´¢æŠ¥ â†’ è§¦å‘æŒä»“è°ƒæ•´

â° äº‹ä»¶3: å›ºå®šæ—¶é—´ç‚¹
   â””â”€ è§¦å‘å™¨: ä½œä¸ºå…œåº•ç­–ç•¥
   â””â”€ ç¤ºä¾‹: æ¯å¤©10:00å¿…é¡»æ£€æŸ¥ä¸€æ¬¡

ğŸ’¸ äº‹ä»¶4: å¸‚åœºæ³¢åŠ¨ç‡çªå¢
   â””â”€ è§¦å‘å™¨: VIXæŒ‡æ•°ä¸Šæ¶¨ > 10%
   â””â”€ ç¤ºä¾‹: å¸‚åœºææ…Œ â†’ è§¦å‘é£æ§å†³ç­–
```

---

## âš–ï¸ å®šæ—¶åˆ†æ vs äº‹ä»¶è§¦å‘

### è¯¦ç»†å¯¹æ¯”è¡¨

| ç»´åº¦ | å®šæ—¶åˆ†æ | äº‹ä»¶è§¦å‘ | æ··åˆæ¨¡å¼ |
|------|---------|---------|---------|
| **å®ç°å¤æ‚åº¦** | â­ ç®€å• | â­â­â­â­ å¤æ‚ | â­â­â­ ä¸­ç­‰ |
| **ä»£ç ä¿®æ”¹é‡** | æœ€å°ï¼ˆ200è¡Œï¼‰ | è¾ƒå¤§ï¼ˆ800è¡Œï¼‰ | ä¸­ç­‰ï¼ˆ500è¡Œï¼‰ |
| **å“åº”é€Ÿåº¦** | æ…¢ï¼ˆå›ºå®šé—´éš”ï¼‰ | å¿«ï¼ˆå®æ—¶å“åº”ï¼‰ | ä¸­ï¼ˆä¸»è¦é å®šæ—¶ï¼‰ |
| **äº¤æ˜“é¢‘ç‡** | ä½ï¼ˆ1-3æ¬¡/å¤©ï¼‰ | é«˜ï¼ˆä¸å¯é¢„æµ‹ï¼‰ | ä¸­ï¼ˆ2-5æ¬¡/å¤©ï¼‰ |
| **APIè°ƒç”¨æˆæœ¬** | ä½ï¼ˆå¯æ§ï¼‰ | é«˜ï¼ˆçªå‘ï¼‰ | ä¸­ï¼ˆåŸºæœ¬å¯æ§ï¼‰ |
| **é€‚ç”¨ç­–ç•¥** | æ—¥çº¿çº§è¶‹åŠ¿è·Ÿè¸ª | é«˜é¢‘äº‹ä»¶é©±åŠ¨ | ä¸­é•¿çº¿+æ³¢åŠ¨åº”å¯¹ |
| **é£é™©æ§åˆ¶** | â­â­â­ ç¨³å®š | â­â­ ä¸å¯é¢„æµ‹ | â­â­â­â­ å¹³è¡¡ |
| **å¯å›æµ‹æ€§** | â­â­â­â­â­ å®Œç¾ | â­â­ éš¾ä»¥å¤ç° | â­â­â­â­ è¾ƒå¥½ |

---

### æ–¹æ¡ˆA: å®šæ—¶åˆ†æï¼ˆæ¨èç”¨äºæ¨¡æ‹Ÿç›˜ï¼‰

#### ä¼˜ç‚¹

âœ… **å®ç°ç®€å•**
- æœ€å°åŒ–ä»£ç ä¿®æ”¹
- å¤ç”¨ç°æœ‰æ¶æ„
- ç±»ä¼¼å½“å‰å›æµ‹æ¨¡å¼

âœ… **æˆæœ¬å¯æ§**
- APIè°ƒç”¨æ¬¡æ•°å›ºå®š
- å¯ç²¾ç¡®é¢„ç®—è´¹ç”¨
- æ— çªå‘æµé‡

âœ… **æ˜“äºå›æµ‹**
- å¯ç²¾ç¡®å¤ç°å†å²å†³ç­–
- æ—¶é—´ç‚¹å›ºå®šï¼Œæ•°æ®ä¸€è‡´
- ä¾¿äºç­–ç•¥ä¼˜åŒ–

âœ… **ç¨³å®šå¯é **
- æ— å¹¶å‘å†²çª
- æ— äº‹ä»¶é£æš´
- æ˜“äºç›‘æ§è°ƒè¯•

#### ç¼ºç‚¹

âŒ **å“åº”å»¶è¿Ÿ**
- é”™è¿‡çŸ­æœŸæœºä¼š
- æ— æ³•å³æ—¶æ­¢æŸ
- å¸‚åœºçªå˜ååº”æ…¢

âŒ **çµæ´»æ€§å·®**
- å›ºå®šæ—¶é—´ç‚¹å¯èƒ½ä¸åˆé€‚
- æ— æ³•é€‚åº”ç‰¹æ®Šæƒ…å†µ

---

### æ–¹æ¡ˆB: äº‹ä»¶è§¦å‘

#### ä¼˜ç‚¹

âœ… **å“åº”è¿…é€Ÿ**
- å®æ—¶æ•æ‰æœºä¼š
- å¿«é€Ÿæ­¢æŸæ­¢ç›ˆ
- é€‚åº”å¸‚åœºå˜åŒ–

âœ… **ç­–ç•¥çµæ´»**
- åŸºäºçœŸå®å¸‚åœºä¿¡å·
- ä¸ªæ€§åŒ–è§¦å‘æ¡ä»¶
- æ”¯æŒå¤æ‚ç­–ç•¥

#### ç¼ºç‚¹

âŒ **å®ç°å¤æ‚**
- éœ€è¦å®æ—¶è¡Œæƒ…è®¢é˜…ï¼ˆWebSocketï¼‰
- äº‹ä»¶æ£€æµ‹é€»è¾‘å¤æ‚
- å¹¶å‘æ§åˆ¶å›°éš¾

âŒ **æˆæœ¬ä¸å¯æ§**
- æ³¢åŠ¨å¤§æ—¶é¢‘ç¹è§¦å‘
- APIè°ƒç”¨æš´å¢
- LLMè´¹ç”¨éš¾ä»¥é¢„æµ‹

âŒ **éš¾ä»¥å›æµ‹**
- äº‹ä»¶æ—¶åºéš¾ä»¥é‡ç°
- å†å²æ•°æ®ä¸å®Œæ•´
- ç­–ç•¥ä¼˜åŒ–å›°éš¾

âŒ **å¯èƒ½è¿‡åº¦äº¤æ˜“**
- é¢‘ç¹ä¹°å–å¢åŠ æˆæœ¬
- å°æ³¢åŠ¨å¼•å‘æ— è°“æ“ä½œ
- Agentå¯èƒ½"ç„¦è™‘"

---

### æ–¹æ¡ˆC: æ··åˆæ¨¡å¼ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

#### è®¾è®¡æ€è·¯

```python
# æ··åˆè§¦å‘ç­–ç•¥

class HybridTrigger:
    def __init__(self):
        # å®šæ—¶è§¦å‘ï¼ˆå…œåº•ï¼‰
        self.scheduled_times = ["10:00", "15:00"]  # æ¯å¤©2æ¬¡

        # äº‹ä»¶è§¦å‘ï¼ˆå¯é€‰ï¼‰
        self.event_rules = [
            {"type": "price_change", "threshold": 0.05, "symbols": ["NVDA", "AAPL"]},
            {"type": "news", "keywords": ["earnings", "merger"]},
        ]

        # é™æµä¿æŠ¤
        self.max_sessions_per_day = 5
        self.min_interval = 3600  # æœ€å°é—´éš”1å°æ—¶

    async def should_trigger(self):
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥è§¦å‘å†³ç­–"""

        # 1. æ£€æŸ¥å®šæ—¶è§¦å‘
        if self.is_scheduled_time():
            return True, "scheduled"

        # 2. æ£€æŸ¥äº‹ä»¶è§¦å‘ï¼ˆå¦‚æœå¯ç”¨ï¼‰
        if self.event_enabled:
            for rule in self.event_rules:
                if self.check_event(rule):
                    # æ£€æŸ¥é™æµ
                    if self.can_trigger():
                        return True, f"event:{rule['type']}"

        return False, None

    def can_trigger(self):
        """é™æµæ£€æŸ¥"""
        # ä»Šå¤©å·²ç»è§¦å‘å‡ æ¬¡
        if self.today_sessions >= self.max_sessions_per_day:
            return False

        # è·ç¦»ä¸Šæ¬¡è§¦å‘æ˜¯å¦è¶…è¿‡æœ€å°é—´éš”
        if time.time() - self.last_trigger < self.min_interval:
            return False

        return True
```

#### ä¼˜ç‚¹

âœ… **å¹³è¡¡æ€§èƒ½å’Œæˆæœ¬**
- å®šæ—¶ä¿è¯åŸºæœ¬è¦†ç›–
- äº‹ä»¶å¢å¼ºå“åº”èƒ½åŠ›
- é™æµæ§åˆ¶æˆæœ¬

âœ… **æ¸è¿›å¼å‡çº§**
- åˆæœŸåªç”¨å®šæ—¶
- åæœŸé€æ­¥åŠ äº‹ä»¶
- çµæ´»è°ƒæ•´ç­–ç•¥

âœ… **é£é™©å¯æ§**
- æœ€å¤§è§¦å‘æ¬¡æ•°é™åˆ¶
- æœ€å°é—´éš”ä¿æŠ¤
- å¼‚å¸¸æƒ…å†µç†”æ–­

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### é˜¶æ®µ1: æ¨¡æ‹Ÿç›˜åˆæœŸï¼ˆæ¨èå®šæ—¶åˆ†æï¼‰

**é…ç½®**:
```json
{
  "mode": "live",
  "trigger_strategy": "scheduled",
  "schedule": {
    "times": ["10:00"],  // æ¯å¤©1æ¬¡ï¼Œç¾ä¸œæ—¶é—´10:00
    "timezone": "US/Eastern"
  },
  "session_config": {
    "max_steps": 30,
    "timeout": 300  // 5åˆ†é’Ÿè¶…æ—¶
  }
}
```

**å®ç°**:
```python
# main.py

async def run_scheduled_trading():
    """å®šæ—¶è§¦å‘äº¤æ˜“ï¼ˆç®€åŒ–ç‰ˆï¼‰"""
    today = datetime.now(pytz.timezone('US/Eastern'))

    # 1. æ£€æŸ¥äº¤æ˜“æ—¥
    if not is_trading_day(today):
        return

    # 2. æ£€æŸ¥æ˜¯å¦åœ¨äº¤æ˜“æ—¶æ®µ
    if not is_market_open(today):
        return

    # 3. æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²ç»äº¤æ˜“
    if already_traded_today():
        print("âš ï¸  Already traded today")
        return

    # 4. è¿è¡Œå•æ¬¡å†³ç­–ä¼šè¯
    await run_single_day_trading(today.strftime("%Y-%m-%d"))

# ä½¿ç”¨Cronå®šæ—¶ä»»åŠ¡
# æ¯ä¸ªäº¤æ˜“æ—¥ 10:00 AM ET è¿è¡Œ
# 0 10 * * 1-5 cd /path && python main.py
```

**ä¼˜åŠ¿**:
- âœ… ä»£ç æ”¹åŠ¨æœ€å°ï¼ˆ~200è¡Œï¼‰
- âœ… å¤ç”¨ç°æœ‰å›æµ‹æ¶æ„
- âœ… ç¨³å®šå¯é ï¼Œæ˜“äºç»´æŠ¤
- âœ… æˆæœ¬ä½ï¼ˆæ¯å¤©1æ¬¡LLMè°ƒç”¨ï¼‰

**é€‚ç”¨åœºæ™¯**:
- æ¨¡æ‹Ÿç›˜éªŒè¯é˜¶æ®µ
- æ—¥çº¿çº§åˆ«ç­–ç•¥
- ä¸­é•¿æœŸæŠ•èµ„ç»„åˆç®¡ç†

---

### é˜¶æ®µ2: ç”Ÿäº§ç¯å¢ƒï¼ˆæ··åˆæ¨¡å¼ï¼‰

**é…ç½®**:
```json
{
  "mode": "live",
  "trigger_strategy": "hybrid",
  "schedule": {
    "times": ["10:00", "15:00"],  // æ¯å¤©2æ¬¡å›ºå®š
    "timezone": "US/Eastern"
  },
  "event_triggers": {
    "enabled": true,
    "rules": [
      {
        "type": "price_change",
        "threshold": 0.05,  // æŒä»“è‚¡ç¥¨æ¶¨è·Œ5%
        "symbols": "holdings"  // åªç›‘æ§æŒä»“
      },
      {
        "type": "vix_spike",
        "threshold": 0.15  // VIXä¸Šæ¶¨15%
      }
    ],
    "limits": {
      "max_sessions_per_day": 5,
      "min_interval_seconds": 3600  // æœ€å°‘1å°æ—¶é—´éš”
    }
  }
}
```

**å®ç°**:
```python
# æ–°å»º agent/live_trading_manager.py

class LiveTradingManager:
    def __init__(self, config):
        self.scheduled_times = config['schedule']['times']
        self.event_rules = config.get('event_triggers', {}).get('rules', [])
        self.max_sessions = config.get('event_triggers', {}).get('limits', {}).get('max_sessions_per_day', 5)

        self.today_sessions = 0
        self.last_trigger_time = None

    async def run_forever(self):
        """ä¸»å¾ªç¯"""
        while True:
            # 1. æ£€æŸ¥å®šæ—¶è§¦å‘
            should_run, reason = await self.should_trigger()

            if should_run:
                print(f"ğŸš€ Trigger: {reason}")
                await self.execute_trading_session(reason)
                self.today_sessions += 1
                self.last_trigger_time = datetime.now()

            # 2. æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
            await asyncio.sleep(60)

            # 3. æ¯æ—¥é‡ç½®è®¡æ•°å™¨
            if self.is_new_day():
                self.today_sessions = 0

    async def should_trigger(self):
        """åˆ¤æ–­æ˜¯å¦è§¦å‘"""
        # 1. å®šæ—¶è§¦å‘
        if self.is_scheduled_time():
            return True, "scheduled"

        # 2. äº‹ä»¶è§¦å‘
        if self.event_enabled:
            for rule in self.event_rules:
                if await self.check_event(rule):
                    if self.can_trigger():
                        return True, f"event:{rule['type']}"

        return False, None

    def can_trigger(self):
        """é™æµæ£€æŸ¥"""
        if self.today_sessions >= self.max_sessions:
            return False

        if self.last_trigger_time:
            interval = (datetime.now() - self.last_trigger_time).seconds
            if interval < 3600:  # 1å°æ—¶
                return False

        return True

    async def check_event(self, rule):
        """æ£€æŸ¥äº‹ä»¶æ˜¯å¦è§¦å‘"""
        if rule['type'] == 'price_change':
            # è·å–æŒä»“è‚¡ç¥¨
            holdings = get_current_holdings()

            # è·å–å®æ—¶ä»·æ ¼
            current_prices = await get_realtime_prices(holdings.keys())

            # è·å–åŸºå‡†ä»·æ ¼ï¼ˆä»Šæ—¥å¼€ç›˜ä»·ï¼‰
            base_prices = await get_open_prices_today(holdings.keys())

            # è®¡ç®—æ¶¨è·Œå¹…
            for symbol in holdings:
                change = (current_prices[symbol] - base_prices[symbol]) / base_prices[symbol]
                if abs(change) > rule['threshold']:
                    print(f"âš¡ {symbol} changed {change*100:.2f}%")
                    return True

        elif rule['type'] == 'vix_spike':
            # æ£€æŸ¥VIXæŒ‡æ•°
            vix_current = await get_vix_index()
            vix_open = await get_vix_open_today()
            vix_change = (vix_current - vix_open) / vix_open

            if vix_change > rule['threshold']:
                print(f"âš¡ VIX spiked {vix_change*100:.2f}%")
                return True

        return False
```

---

### å†³ç­–æµç¨‹å¯¹æ¯”

#### å½“å‰å›æµ‹æ¨¡å¼
```
æ¯å¤©1æ¬¡å†³ç­–ä¼šè¯
  â””â”€ 10:00 (è™šæ‹Ÿæ—¶é—´)
       â”œâ”€ è·å–å¼€ç›˜ä»·ï¼ˆé™æ€æ•°æ®ï¼‰
       â”œâ”€ Agentæ€è€ƒ + å¤šæ¬¡äº¤æ˜“
       â””â”€ è¾“å‡º <FINISH_SIGNAL>

ç»“æœ: 1æ¬¡ä¼šè¯ï¼ŒNæ¬¡äº¤æ˜“ï¼ˆ1-8æ¬¡ï¼‰
```

#### æ¨¡æ‹Ÿç›˜å®šæ—¶æ¨¡å¼ï¼ˆæ¨èåˆæœŸï¼‰
```
æ¯å¤©1æ¬¡å†³ç­–ä¼šè¯
  â””â”€ 10:00 (çœŸå®æ—¶é—´)
       â”œâ”€ è·å–å¼€ç›˜ä»·ï¼ˆAlpaca APIï¼‰
       â”œâ”€ Agentæ€è€ƒ + å¤šæ¬¡äº¤æ˜“
       â””â”€ è¾“å‡º <FINISH_SIGNAL>

ç»“æœ: 1æ¬¡ä¼šè¯ï¼ŒNæ¬¡äº¤æ˜“ï¼ˆ1-8æ¬¡ï¼‰
APIæˆæœ¬: ~$0.01/å¤©ï¼ˆClaudeï¼‰
```

#### æ¨¡æ‹Ÿç›˜æ··åˆæ¨¡å¼ï¼ˆæ¨èç”Ÿäº§ï¼‰
```
æ¯å¤©2-5æ¬¡å†³ç­–ä¼šè¯
  â”œâ”€ 10:00 (å®šæ—¶è§¦å‘)
  â”‚    â”œâ”€ è·å–æœ€æ–°ä»·æ ¼
  â”‚    â”œâ”€ Agentæ€è€ƒ + äº¤æ˜“
  â”‚    â””â”€ ç»“æŸ
  â”‚
  â”œâ”€ 13:25 (äº‹ä»¶è§¦å‘: NVDAæ¶¨6%)
  â”‚    â”œâ”€ è·å–æœ€æ–°ä»·æ ¼
  â”‚    â”œâ”€ Agentæ€è€ƒ: "NVDAæ¶¨å¹…è¿‡å¤§ï¼Œæ­¢ç›ˆ"
  â”‚    â”œâ”€ sell("NVDA", 5)
  â”‚    â””â”€ ç»“æŸ
  â”‚
  â””â”€ 15:00 (å®šæ—¶è§¦å‘)
       â”œâ”€ è·å–æœ€æ–°ä»·æ ¼
       â”œâ”€ Agentæœ€åæ£€æŸ¥
       â””â”€ ç»“æŸ

ç»“æœ: 2-5æ¬¡ä¼šè¯ï¼ŒNæ¬¡äº¤æ˜“
APIæˆæœ¬: ~$0.02-0.05/å¤©
```

---

## ğŸ“Š å®æ–½å»ºè®®

### ç¬¬ä¸€æ­¥ï¼šæ¨¡æ‹Ÿç›˜éªŒè¯ï¼ˆ1-2å‘¨ï¼‰

**ç›®æ ‡**: éªŒè¯ç³»ç»Ÿç¨³å®šæ€§

**é…ç½®**:
```json
{
  "trigger_strategy": "scheduled",
  "schedule": {"times": ["10:00"]},  // æ¯å¤©1æ¬¡
  "models": [{"name": "claude-3.7-sonnet", "enabled": true}]  // å•æ¨¡å‹
}
```

**è§‚å¯ŸæŒ‡æ ‡**:
- âœ… APIè°ƒç”¨æˆåŠŸç‡
- âœ… Agentå†³ç­–è´¨é‡
- âœ… ç³»ç»Ÿç¨³å®šæ€§
- âœ… æˆæœ¬æ§åˆ¶

---

### ç¬¬äºŒæ­¥ï¼šå¢åŠ è§¦å‘é¢‘ç‡ï¼ˆ2-4å‘¨ï¼‰

**ç›®æ ‡**: æµ‹è¯•å¤šæ—¶æ®µå†³ç­–

**é…ç½®**:
```json
{
  "trigger_strategy": "scheduled",
  "schedule": {"times": ["10:00", "14:00", "15:30"]},  // æ¯å¤©3æ¬¡
}
```

**è§‚å¯ŸæŒ‡æ ‡**:
- äº¤æ˜“é¢‘ç‡æ˜¯å¦åˆç†
- æ˜¯å¦è¿‡åº¦äº¤æ˜“
- ç­–ç•¥æ”¶ç›Šå˜åŒ–

---

### ç¬¬ä¸‰æ­¥ï¼šå¯ç”¨äº‹ä»¶è§¦å‘ï¼ˆ1ä¸ªæœˆåï¼‰

**ç›®æ ‡**: å¢å¼ºå“åº”èƒ½åŠ›

**é…ç½®**:
```json
{
  "trigger_strategy": "hybrid",
  "event_triggers": {
    "rules": [
      {"type": "price_change", "threshold": 0.05}
    ],
    "limits": {"max_sessions_per_day": 5}
  }
}
```

**è§‚å¯ŸæŒ‡æ ‡**:
- äº‹ä»¶è§¦å‘æ¬¡æ•°
- å“åº”åŠæ—¶æ€§
- æˆæœ¬å¢é•¿

---

## ğŸ¯ æ€»ç»“

### å…³é”®ç»“è®º

| é—®é¢˜ | å›ç­” |
|------|------|
| **å½“å‰å›æµ‹ä¸€å¤©å‡ æ¬¡å†³ç­–ï¼Ÿ** | 1æ¬¡ä¼šè¯ï¼Œä½†ä¼šè¯å†…å¯èƒ½å¤šæ¬¡äº¤æ˜“ï¼ˆ1-8æ¬¡ï¼‰ |
| **æ¨¡æ‹Ÿç›˜åº”è¯¥ç”¨å®šæ—¶è¿˜æ˜¯äº‹ä»¶ï¼Ÿ** | åˆæœŸç”¨å®šæ—¶ï¼ŒåæœŸå¯å‡çº§æ··åˆ |
| **æ¨èè§¦å‘æ—¶é—´ç‚¹ï¼Ÿ** | æ—©ç›˜10:00ï¼ˆå¿…é¡»ï¼‰+ å°¾ç›˜15:00ï¼ˆå¯é€‰ï¼‰ |
| **æœ€å¤§è§¦å‘æ¬¡æ•°é™åˆ¶ï¼Ÿ** | å»ºè®®5æ¬¡/å¤©ï¼ˆé˜²æ­¢è¿‡åº¦äº¤æ˜“ï¼‰ |
| **å®ç°ä¼˜å…ˆçº§ï¼Ÿ** | å®šæ—¶åˆ†æï¼ˆP0ï¼‰ > æ··åˆæ¨¡å¼ï¼ˆP1ï¼‰ > çº¯äº‹ä»¶ï¼ˆP2ï¼‰ |

### æœ€å°å¯è¡Œæ–¹æ¡ˆï¼ˆMVPï¼‰

```python
# main.py - æœ€ç®€å®ç°

async def run_live_trading():
    """æ¨¡æ‹Ÿç›˜æ¨¡å¼ï¼šæ¯å¤©10:00è¿è¡Œä¸€æ¬¡"""
    today = datetime.now().strftime("%Y-%m-%d")

    # å¤ç”¨ç°æœ‰é€»è¾‘
    await agent.run_trading_session(today)

# Croné…ç½®
# 0 10 * * 1-5 cd /path && python main.py
```

**ä»£ç ä¿®æ”¹é‡**: ~50è¡Œ
**å·¥æœŸ**: 1å¤©
**æ•ˆæœ**: ä¸å›æµ‹æ¨¡å¼å‡ ä¹ä¸€è‡´ï¼Œåªæ˜¯è§¦å‘æ—¶é—´å˜ä¸ºçœŸå®æ—¶é—´

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-10-27
**ä½œè€…**: AI-Trader Team
